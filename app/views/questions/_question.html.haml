-title = h(question.title)
-if question.closed
  -title += " [ZAMKNIÄ˜TE]"

-if !local_assigns[:mini]
  -owner = nil
  - if question.last_target_id.present?
    - last_target_id = question.last_target_id
    - last_target_date = question.last_target_date
    - owner = question.last_target_user
  -else
    - last_target = question
    - last_target_date = question.updated_at
    - owner = question.user unless question.anonymous
  - creation_date = question.created_at

  %article{:class => [class_for_question(question), "full"] }
    .counters
      - votecount = question.votes_average
      .votecount
        .count
          = votecount
        .tail
          = t(:votes, { :scope => "counters", :count => votecount})
      - answercount = question.answers_count
      - answered = question.answered
      - if answercount != 0
        - if answered
          .answercount-accepted
            .count
              = answercount
            .tail
              = t(:answers, { :scope => "counters", :count => answercount})
        - else
          .answercount
            .count
              = answercount
            .tail
              = t(:answers, { :scope => "counters", :count => answercount})
      - else
        .answercount-none
          .count
            = answercount
          .tail
            = t(:answers, { :scope => "counters", :count => answercount})
      - viewcount = question.views_count
      .viewcount
        .count
          = viewcount
        .tail
          = t(:views, { :scope => "counters", :count => viewcount})
    .summary
      -cache("question_on_index_#{question.id}_#{I18n.locale}") do
        %h2
          = link_to title, question_path(question), :title => truncate(strip_tags(question.body), :length => 200)
        %p
          = truncate(strip_tags(question.body), :length => 200)

      .user-data.left
        %span.timeago{ :title => l((@active_subtab.to_s == "najnowsze") ? creation_date : last_target_date, :format => :iso) }
          %span.normal
            = (@active_subtab.to_s == "najnowsze") ? t(:asked, :scope => "questions") : t(:modified, :scope => "questions")
          = time_ago_in_full_words((@active_subtab.to_s == "najnowsze") ? creation_date : last_target_date)
        %p
          -if owner
            =render :partial => "users/user_data", :locals => {:user => owner}
          -else
            anonim

      .tags
        %ul
          -if question.wiki
            %li{:class => "wiki" }
              wiki
          %li{:class => "tag_gielda"}
            gielda
          %li{:class => "tag_gielda"}
            pytanie
          -question.first_tags.each do |tag|
            %li{:class => "tag_#{h(tag)}"}
              = link_to h(tag), tag_path(:id => tag), :rel => "tag", :title => t("questions.tags.tooltip", :tag => tag)
          -if question.tags.empty? && logged_in? && (current_user.can_modify?(@question) || current_user.can_retag_others_questions_on?(current_group))
            %li
              = link_to t('questions.show.retag'), retag_question_path(question), :id => 'retag', :class => "important"
    .clear

-else
  -cache("mini_question_on_index_#{question.id}_#{I18n.locale}") do
    %article{:class => "#{class_for_question(question)} #{local_assigns[:lite] ? 'lite' : ''}"}

      %h3
        = link_to title, question_path(question)

      .toolbar
        %ul
          %li.answers
            = link_to "#{format_number(question.answers_count)} #{t(:answers, :scope => "activerecord.attributes.question")}"
